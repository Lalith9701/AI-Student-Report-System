<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Report Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/darkly/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-dark text-light">
<div class="container mt-5">
    <h2 class="text-center mb-4">📊 Student Performance Dashboard</h2>

    <!-- Top 10 Students -->
    <h3 class="text-center mb-4">🏆 Top 10 Students</h3>
    <div class="row justify-content-center mb-5">
        {% for student in results[:10] %}
        <div class="col-md-4 mb-3">
            <div class="card text-center bg-dark text-light shadow hover-card">
                <div class="card-body">
                    <h5 class="card-title">{{ student.name }}</h5>
                    <p class="card-text">Marks: {{ student.marks }}</p>
                    <span class="badge {% if student.rank==1 %} bg-success {% elif student.rank==2 %} bg-primary {% elif student.rank==3 %} bg-warning text-dark {% else %} bg-secondary {% endif %}">
                        Rank {{ student.rank }}
                    </span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Charts -->
    <div class="row">
        <div class="col-md-6">
            <canvas id="marksChart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="performanceChart"></canvas>
        </div>
    </div>
    <!-- Add after charts -->
<h3 class="text-center mt-5 mb-3">📋 All Students</h3>
<table class="table table-striped table-dark table-hover rounded-4">
    <thead>
        <tr>
            <th>Rank</th>
            <th>Name</th>
            <th>Marks</th>
            <th>Performance</th>
        </tr>
    </thead>
    <tbody>
        {% for student in results %}
        <tr>
            <td>{{ student.rank }}</td>
            <td>{{ student.name }}</td>
            <td>{{ student.marks }}</td>
            <td>{{ student.Performance }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>


    <!-- Buttons -->
    <div class="text-center mt-4">
        <a href="{{ url_for('download_file', processed_filename=processed_filename) }}" class="btn btn-success btn-lg">💾 Download Report</a>
        <a href="{{ url_for('welcome') }}" class="btn btn-primary btn-lg">🏠 Home</a>
    </div>
</div>

<script>
const labels = {{ results | map(attribute='name') | list | safe }};
const marks = {{ results | map(attribute='marks') | list | safe }};
const performanceList = {{ results | map(attribute='Performance') | list | safe }};

// Marks Chart
new Chart(document.getElementById('marksChart').getContext('2d'), {
    type: 'bar',
    data: { labels: labels, datasets: [{ label: 'Marks', data: marks, backgroundColor: '#3498db' }] },
    options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
});

// Performance Pie
const perfData = {
    'Excellent': performanceList.filter(p => p==='Excellent').length,
    'Average': performanceList.filter(p => p==='Average').length,
    'Needs Improvement': performanceList.filter(p => p==='Needs Improvement').length
};
new Chart(document.getElementById('performanceChart').getContext('2d'), {
    type: 'pie',
    data: { labels: Object.keys(perfData), datasets: [{ data: Object.values(perfData), backgroundColor: ['#28a745','#ffc107','#dc3545'] }] },
    options: { responsive: true }
});
</script>

<style>
.hover-card { transition: transform 0.2s; }
.hover-card:hover { transform: scale(1.05); }
</style>
</body>
</html>
